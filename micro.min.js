/**
 * troopjs-bundle - 2.0.0-110-g4a31219
 * @license MIT http://troopjs.mit-license.org/ Â© Mikael Karon mailto:mikael@karon.se
 */
define("troopjs-utils/unique",[],function(){"use strict";var a="length";return function(b){var c,d,e,f,g=this,h=g[a];if(b)a:for(d=f=0;h>d;d++){for(c=g[d],e=0;d>e;e++)if(b.call(g,c,[e])===!0)continue a;g[f++]=c}else a:for(d=f=0;h>d;d++){for(c=g[d],e=0;d>e;e++)if(c===g[e])continue a;g[f++]=c}return g[a]=f,f}}),define("poly/lib/_base",["require","exports","module"],function(a,b){var c;c={}.toString,b.isFunction=function(a){return"function"==typeof a},b.isString=function(a){return"[object String]"==c.call(a)},b.toString=function(a){return c.apply(a)},b.createCaster=function(a,b){return function(c){if(null==c)throw new TypeError(b+" method called on null or undefined");return a(c)}}}),define("poly/object",["./lib/_base"],function(a){"use strict";function b(a){return function(){throw new Error("poly/object: "+a+" is not safely supported.")}}function c(b){var c=o[b];return a.isFunction(c)?c(i):c in i}function d(){}function e(a,b){return a.hasOwnProperty(b)}function f(a){var b=[];for(var c in a)e(a,c)&&b.push(c);return b}function g(a){var c;c="function"==typeof a?a:function(){return a};for(var d in p)Object[d]=c(d)?b(d):p[d]}function h(a){if("object"!=typeof a)throw new TypeError("Object.getPrototypeOf called on non-object")}var i,j,k,l,m,n,o,p,q,r,s,t="hasOwnProperty";return i=Object,j=i.prototype,k="object"==typeof{}.__proto__,l=function(){for(var a in{valueOf:1})return!1;return!0}(),m=k?function(a){return h(a),a.__proto__}:function(a){return h(a),r&&a[r](q)?a[r](q.proto):a.constructor?a.constructor.prototype:j},n=l?function(a){return function(b){for(var c,d=f(b),g=0;c=a[g++];)e(b,c)&&d.push(c);return d}}(["constructor",t,"isPrototypeOf","propertyIsEnumerable","toString","toLocaleString","valueOf"]):f,o={"object-create":"create","object-freeze":"freeze","object-isfrozen":"isFrozen","object-seal":"seal","object-issealed":"isSealed","object-getprototypeof":"getPrototypeOf","object-keys":"keys","object-getownpropertynames":"getOwnPropertyNames","object-defineproperty":function(a){try{return"defineProperty"in a&&"sentinel"in Object.defineProperty({},"sentinel",{})}catch(b){}},"object-defineproperties":"defineProperties","object-isextensible":"isExtensible","object-preventextensions":"preventExtensions","object-getownpropertydescriptor":function(a){try{return"getOwnPropertyDescriptor"in a&&0===Object.getOwnPropertyDescriptor({sentinel:0}).value}catch(b){}}},p={},q={proto:{}},r=!c("object-getprototypeof")&&!k&&l&&t,r&&function(a){j[t]=function(b){return b==r?!1:a.call(this,b)}}(j[t]),c("object-create")||(Object.create=p.create=function(a,b){var c;if("object"!=typeof a)throw new TypeError("prototype is not of type Object or Null.");if(d.prototype=a,c=new d,d.prototype=null,r){var e=c[r];c[r]=function(b){return b==q?!0:b==q.proto?a:e.call(this,b)}}return arguments.length>1&&Object.defineProperties(c,b),c}),c("object-freeze")||(Object.freeze=p.freeze=function(a){return a}),c("object-isfrozen")||(Object.isFrozen=p.isFrozen=function(){return!1}),c("object-seal")||(Object.seal=p.seal=function(a){return a}),c("object-issealed")||(Object.isSealed=p.isSealed=function(){return!1}),c("object-getprototypeof")||(Object.getPrototypeOf=p.getPrototypeOf=m),c("object-keys")||(Object.keys=n),c("object-getownpropertynames")||(Object.getOwnPropertyNames=p.getOwnPropertyNames=function(a){return n(a)}),c("object-defineproperty")&&c("object-defineproperties")||(Object.defineProperty=p.defineProperty=function(a,b,c){return a[b]=c&&c.value,a}),c("object-defineproperties")&&c("object-create")||(Object.defineProperties=p.defineProperties=function(a,b){var c,d;for(c=n(b);d=c.pop();)Object.defineProperty(a,d,b[d]);return a}),c("object-isextensible")||(Object.isExtensible=p.isExtensible=function(a){var b="_poly_";try{for(;b in a;)b+="_";return a[b]=1,e(a,b)}catch(c){return!1}finally{try{delete a[b]}catch(c){}}}),c("object-preventextensions")||(Object.preventExtensions=p.preventExtensions=function(a){return a}),c("object-getownpropertydescriptor")||(Object.getOwnPropertyDescriptor=p.getOwnPropertyDescriptor=function(a,b){return e(a,b)?{value:a[b],enumerable:!0,configurable:!0,writable:!0}:s}),{failIfShimmed:g}}),define("troopjs-core/component/factory",["troopjs-utils/unique","poly/object"],function(a){"use strict";function b(){return c.apply(this,arguments)()}function c(){var a=[this];return m.apply(a,arguments),i.apply(null,a)}function d(a,b){var c={};c[v]={value:a},c[u]={value:b},Object.defineProperties(this,c)}function e(a){return new d(a,e[u])}function f(a){return new d(a,f[u])}function g(a){return new d(a,g[u])}function h(){var a=this,b=a[j];return q in b?b[q]:o.call(a)}function i(){function e(){var a,b=this instanceof e?this:Object.create(Q),c=arguments;for(Object.defineProperty(b,z,{value:e}),a=0;l>a;a++)c=P[a].apply(b,c)||c;return b}var f,g,i,l,o,q,v,w,x,y,I,J,K,L,M=[],N=arguments,O=N[r],P=[],Q={},R={},S={};for(w=0;O>w;w++){if(i=N[w],typeof i===p){if(A in i?m.apply(P,i[A]):m.call(P,i),B in i&&n.apply(M,i[B]),i===i[j][z])continue;i=i[j]}for(q=Object.getOwnPropertyNames(i),x=0,v=q[r];v>x;x++)o=q[x],(J=H.exec(o))?(f={},f[C]=y=J[1],f[E]=J[2],f[F]=I=J[3],f[G]=y+"/"+I,f[D]=i[o],n.call(M,f)):(L=Object.getOwnPropertyDescriptor(i,o),K=L[D],R[o]=K instanceof d?K[u](R[o]||{enumerable:!0,configurable:!0,writable:!0}):L)}for(Object.defineProperties(Q,R),l=a.call(P),g=a.call(M),w=0;g>w;w++)f=M[w],y=f[C],I=f[F],o=f[G],y=y in M?M[y]:M[y]=[],I=I in y?y[I]:y[I]=M[o]=[],y[y[r]]=I[I[r]]=f;return S[j]={value:Q},S[A]={value:P},S[B]={value:M},S[k]={value:h},S[s]={value:c},S[t]={value:b},Object.defineProperties(e,S),e}var j="prototype",k="toString",l=Array[j],m=l.push,n=l.unshift,o=Object[j][k],p="function",q="displayName",r="length",s="extend",t="create",u="decorate",v="decorated",w="before",x="after",y="around",z="constructor",A="constructors",B="specials",C="group",D="value",E="features",F="type",G="name",H=/^(\w+)(?::([^\/]+))?\/(.+)/,I=function(){},J={};return e[u]=function(a){var b=this[v],c=a[D];return a[D]=c?function(){var a=this,d=arguments;return c.apply(a,d=b.apply(a,d)||d)}:b,a},f[u]=function(a){var b=a[D],c=this[v];return a[D]=b?function(){var a=this,d=arguments;return c.apply(a,d=b.apply(a,d)||d)}:c,a},g[u]=function(a){return a[D]=this[v](a[D]||I),a},J[t]={value:function(){return i.apply(null,arguments)()}},J[w]={value:e},J[x]={value:f},J[y]={value:g},Object.defineProperties(i,J),i}),function(a,b){"use strict";a("when/when",[],function(){function a(a,b,c,e){return d(a).then(b,c,e)}function c(a,b){this.then=a,this.inspect=b}function d(a){return g(function(b){b(a)})}function e(b){return a(b,j)}function f(){function a(a,f,g){b.resolve=b.resolver.resolve=function(b){return e?d(b):(e=!0,a(b),c)},b.reject=b.resolver.reject=function(a){return e?d(j(a)):(e=!0,f(a),c)},b.notify=b.resolver.notify=function(a){return g(a),a}}var b,c,e;return b={promise:L,resolve:L,reject:L,notify:L,resolver:{resolve:L,reject:L,notify:L}},b.promise=c=g(a),b}function g(a){function b(a,b,c){return g(function(d,e,f){n?n.push(function(g){g.then(a,b,c).then(d,e,f)}):y(function(){m.then(a,b,c).then(d,e,f)})})}function d(){return m?m.inspect():x()}function e(a){n&&(m=h(a),l(n,m),n=L)}function f(a){e(j(a))}function i(a){n&&l(n,k(a))}var m,n=[];try{a(e,f,i)}catch(o){f(o)}return new c(b,d)}function h(a){return a instanceof c?a:a===Object(a)&&"then"in a?g(function(b,c,d){y(function(){try{var e=a.then;"function"==typeof e?E(e,a,b,c,d):b(i(a))}catch(f){c(f)}})}):i(a)}function i(a){var b=new c(function(c){try{return"function"==typeof c?h(c(a)):b}catch(d){return j(d)}},function(){return v(a)});return b}function j(a){var b=new c(function(c,d){try{return"function"==typeof d?h(d(a)):b}catch(e){return j(e)}},function(){return w(a)});return b}function k(a){var b=new c(function(c,d,e){try{return"function"==typeof e?k(e(a)):b}catch(f){return k(f)}});return b}function l(a,b){y(function(){for(var c,d=0;c=a[d++];)c(b)})}function m(a){return a&&"function"==typeof a.then}function n(b,c,d,e,f){return a(b,function(b){function h(d,e,f){function g(a){n(a)}function h(a){m(a)}var i,j,k,l,m,n,o,p;if(o=b.length>>>0,i=Math.max(0,Math.min(c,o)),k=[],j=o-i+1,l=[],i)for(n=function(a){l.push(a),--j||(m=n=B,e(l))},m=function(a){k.push(a),--i||(m=n=B,d(k))},p=0;o>p;++p)p in b&&a(b[p],h,g,f);else d(k)}return g(h).then(d,e,f)})}function o(a,b,c,d){function e(a){return b?b(a[0]):a[0]}return n(a,1,e,c,d)}function p(a,b,c,d){return t(a,B).then(b,c,d)}function q(){return t(arguments,B)}function r(a){return t(a,v,w)}function s(a,b){return t(a,b)}function t(b,c,d){return a(b,function(b){function e(e,f,g){var h,i,j,k,l;if(j=i=b.length>>>0,h=[],!j)return e(h),void 0;for(k=function(b,i){a(b,c,d).then(function(a){h[i]=a,--j||e(h)},f,g)},l=0;i>l;l++)l in b?k(b[l],l):--j}return g(e)})}function u(b,c){var d=E(D,arguments,1);return a(b,function(b){var e;return e=b.length,d[0]=function(b,d,f){return a(b,function(b){return a(d,function(a){return c(b,a,f,e)})})},C.apply(b,d)})}function v(a){return{state:"fulfilled",value:a}}function w(a){return{state:"rejected",reason:a}}function x(){return{state:"pending"}}function y(a){1===G.push(a)&&z()}function z(){F(A)}function A(){for(var a,b=0;a=G[b++];)a();G=[]}function B(a){return a}a.defer=f,a.resolve=d,a.reject=e,a.join=q,a.all=p,a.map=s,a.reduce=u,a.settle=r,a.any=o,a.some=n,a.isPromise=m,a.promise=g,c.prototype={otherwise:function(a){return this.then(L,a)},ensure:function(a){function b(){return d(a())}return this.then(b,b).yield(this)},yield:function(a){return this.then(function(){return a})},spread:function(a){return this.then(function(b){return p(b,function(b){return a.apply(L,b)})})},always:function(a,b){return this.then(a,a,b)}};var C,D,E,F,G,H,I,J,K,L;return G=[],H=b.setTimeout,F="function"==typeof setImmediate?setImmediate.bind(b):"object"==typeof process&&process.nextTick?process.nextTick:"object"==typeof vertx?vertx.runOnLoop:function(a){H(a,0)},I=Function.prototype,J=I.call,E=I.bind?J.bind(J):function(a,b){return a.apply(b,D.call(arguments,2))},K=[],D=K.slice,C=K.reduce||function(a){var b,c,d,e,f;if(f=0,b=Object(this),e=b.length>>>0,c=arguments,c.length<=1)for(;;){if(f in b){d=b[f++];break}if(++f>=e)throw new TypeError}else d=c[1];for(;e>f;++f)f in b&&(d=a(d,b[f],f,b));return d},a})}("function"==typeof define&&define.amd?define:function(a){module.exports=a()},this),define("when",["when/when"],function(a){return a}),define("troopjs-utils/merge",["poly/object"],function(){"use strict";var a="length",b=Array.prototype,c=b.concat,d=Object.prototype,e=d.toString,f=e.call(d),g=e.call(b);return function h(b){var d,i,j,k,l,m,n,o,p,q,r=this;for(j=0,l=arguments[a];l>j;j++)for(b=arguments[j],i=Object.keys(b),k=0,m=i[a];m>k;k++)d=i[k],n=b[d],o=r[d],d in r?(p=e.call(n),q=e.call(o),q===f&&p===f?h.call(o,n):r[d]=q===g&&p===g?c.call(o,n):n):r[d]=n;return r}}),define("troopjs-core/component/base",["./factory","when","troopjs-utils/merge"],function(a,b,c){"use strict";var d=Array.prototype,e=d.push,f=d.slice,g="instanceCount",h="configuration",i="phase",j="value",k="initialize",l="stop",m="sig",n=0;return a(function(){var a=this;a[g]=++n,a[h]={}},{instanceCount:n,displayName:"core/component/base",configure:function(){return c.apply(this[h],arguments)},signal:function(a){function c(a){return++n>-1&&(l[n]=a),(d=i[k++])?b(d[j].apply(e,g),c):b.resolve(l)}var d,e=this,g=f.call(arguments,1),h=e.constructor.specials,i=m in h&&h[m][a]||[],k=0,l=[],n=-2;return c(g)},start:function(){var a=this,b=a.signal,c=[k];return a[i]=k,e.apply(c,arguments),b.apply(a,c).then(function(e){return c[0]=a[i]="start",b.apply(a,c).then(function(b){return a[i]="started",d.concat(e,b)})})},stop:function(){var a=this,b=a.signal,c=[l];return a[i]=l,e.apply(c,arguments),b.apply(a,c).then(function(e){return c[0]=a[i]="finalize",b.apply(a,c).then(function(b){return a[i]="finalized",d.concat(e,b)})})},toString:function(){var a=this;return a.displayName+"@"+a[g]}})}),define("troopjs-core/logger/console",["../component/base"],function(a){"use strict";function b(){}var c=console;return a.create({displayName:"core/logger/console"},c?{log:c.log.bind(c),warn:c.warn.bind(c),debug:c.debug.bind(c),info:c.info.bind(c),error:c.error.bind(c)}:{log:b,warn:b,debug:b,info:b,error:b})}),define("poly/array",["./lib/_base"],function(a){"use strict";function b(b){return"[object String]"==a.toString(b)?b.split(""):i(b)}function c(a){return"[object Array]"==n.call(a)}function d(b){var c=h[b];return a.isFunction(m[c])}function e(){return 1}function f(a){return a}function g(c,d,e,f,g,h){var i,j,k,m;if(i=b(c),j=i.length>>>0,g===l&&(g=0),h||(h=1),m=0>h?-1:j,!a.isFunction(d))throw new TypeError(d+" is not a function");if(g==m)return!1;if(m>=g^h>0)throw new TypeError("Invalid length or starting index");for(k=g;k!=m;k+=h)if(k in i&&!e(d.call(f,i[k],k,i),k,i[k]))return!1;return!0}var h,i,j,k,l,m=Array.prototype,n={}.toString;h={"array-foreach":"forEach","array-every":"every","array-some":"some","array-map":"map","array-filter":"filter","array-reduce":"reduce","array-reduceright":"reduceRight","array-indexof":"indexOf","array-lastindexof":"lastIndexOf"},i=a.createCaster(Object,"Array"),d("array-foreach")||(m.forEach=function(a){g(this,a,e,arguments[1])}),d("array-every")||(m.every=function(a){return g(this,a,f,arguments[1])}),d("array-some")||(m.some=function(a){return g(this,a,function(a){return!a},arguments[1])}),d("array-map")||(m.map=function(a){var b,c;return b=this,c=new Array(b.length),g(b,a,function(a,b){return c[b]=a,1},arguments[1]),c}),d("array-filter")||(m.filter=function(a){var b,c;return b=this,c=[],g(b,a,function(a,b,d){return a&&c.push(d),1},arguments[1]),c}),d("array-reduce")&&d("array-reduceright")||(j=function(a,c,d,h){var i,j,k;if(j=k=c>0?-1:b(this).length>>>0,h)i=d;else if(g(this,f,function(a,b){i=a,k=b},null,j+c,c),k==j)throw new TypeError;return g(this,function(b,c,d){i=a(i,b,c,d)},e,null,k+c,c),i},d("array-reduce")||(m.reduce=function(a){return j.call(this,a,1,arguments[1],arguments.length>1)}),d("array-reduceright")||(m.reduceRight=function(a){return j.call(this,a,-1,arguments[1],arguments.length>1)})),d("array-indexof")&&d("array-lastindexof")||(k=function(a,c,d,e){var h=b(a).length>>>0,i=-1;return d=isNaN(d)?e?0:h-1:Number(d),0>d&&(d=h+d-1),g(a,f,function(a,b){return a===c&&(i=b),-1==i},null,d,e?1:-1),i},d("array-indexof")||(m.indexOf=function(a){return k(this,a,arguments[1],!0)}),d("array-lastindexof")||(m.lastIndexOf=function(a){return k(this,a,arguments[1],!1)})),Array.isArray||(Array.isArray=c)}),define("troopjs-core/event/emitter",["../component/base","when","poly/array"],function(a,b){"use strict";function c(a,c,d){d=d||[];var e=0,f=d[j],g=f-1,k=function(j){var l,m;if(!t(j))throw new Error("Result from handler has to be of type array");for(g++>=f&&(d[g]=j);(m=a[e++])&&(l=m[h])&&r.test(l[p]););return m?(m[n]=c)===c&&b(m[i].apply(l,j),k):b.resolve(d)};return k}function d(a,c,d){d=d||{};var f,j=0,k=function(l){var m,o;if(l!==e){if(!t(l))throw new Error("Result from handler has to be of type array");d[g]=f=l}for(;(o=a[j++])&&(m=o[h])&&r.test(m[p]););return o?(o[n]=c)===c&&b(o[i].apply(m,f),k):b.resolve(f)};return k}var e,f=null,g="memory",h="context",i="callback",j="length",k="head",l="tail",m="next",n="handled",o="handlers",p="phase",q=/^(\w+)(?::(pipeline|sequence))/,r=/^(?:initi|fin)alized?$/,s=Array.prototype.slice,t=Array.isArray,u=Object.prototype.toString,v=u.call(Function.prototype);return a.extend(function(){this[o]={}},{displayName:"core/event/emitter",on:function(a,b,c){var d,f,g,j=this,p=arguments,q=j[o],r=2;if((c=p[r++])===e)throw new Error("no callback provided");if(u.call(c)!==v)throw new Error(u.call(c)+" is not a function");if(a in q){q=q[a],d={},d[i]=c,d[h]=b,g=l in q?q[l][m]=d:q[k]=d;for(;(c=p[r++])!==e;){if(u.call(c)!==v)throw new Error(u.call(c)+" is not a function");g=g[m]=d={},d[i]=c,d[h]=b}q[l]=g}else{for(f=g=d={},d[i]=c,d[h]=b;(c=p[r++])!==e;){if(u.call(c)!==v)throw new Error(u.call(c)+" is not a function");g=g[m]=d={},d[i]=c,d[h]=b}q=q[a]={},q[k]=f,q[l]=g,q[n]=0}return j},off:function(a,b){var c,d,e,f,g,n=this,p=arguments,q=p[j],r=n[o];if(!(a in r))return n;if(r=r[a],!(k in r))return n;c=r[k];do{if(!b||!c[h]||c[h]===b){for(g=!1,f=2;q>f;f++)if(c[i]===p[f]){g=!0;break}if(g)continue}d?e=e[m]=c:d=e=c}while(c=c[m]);return d&&e?(r[k]=d,r[l]=e,delete e[m]):(delete r[k],delete r[l]),n},emit:function(a){var e,h,i,j,l,p=this,r=s.call(arguments,1),t=p[o];if((j=q.exec(a))!==f&&(a=j[1],l=j[2]),a in t){if(t=t[a],k in t){h=[],i=0,e=t[k];do h[i++]=e;while(e=e[m]);return"sequence"===l?c(h,++t[n])(r):d(h,++t[n],t)(r)}}else t[a]=t={},t[n]=0;return t[g]=r,b.resolve(r)},reemit:function(a,e,l){var p,r,s,t,u,v,w,x,y=this,z=arguments,A=z[j],B=y[o];if((u=q.exec(a))!==f&&(a=u[1],v=u[2]),a in B&&(B=B[a],g in B)){if(!(k in B))return b.resolve(B[g]);s=[],t=0,p=B[k],r=B[n];do if(!l||!p[h]||p[h]===l){for(x=!1,w=3;A>w;w++)if(p[i]===z[w]){x=!0;break}(!x||p[n]!==r||e)&&(s[t++]=p)}while(p=p[m]);return"sequence"===v?c(s,r)(B[g]):d(s,r)(B[g])}return b.resolve()}})}),define("troopjs-core/pubsub/hub",["../event/emitter"],function(a){"use strict";var b=a.prototype;return a.create({displayName:"core/pubsub/hub",subscribe:b.on,unsubscribe:b.off,publish:b.emit,republish:b.reemit})}),define("troopjs-core/logger/pubsub",["../component/base","../pubsub/hub"],function(a,b){"use strict";var c=Array.prototype.push,d=b.publish;return a.create({displayName:"core/logger/pubsub",log:function(){var a=["logger/log"];c.apply(a,arguments),d.apply(b,a)},warn:function(){var a=["logger/warn"];c.apply(a,arguments),d.apply(b,a)},debug:function(){var a=["logger/debug"];c.apply(a,arguments),d.apply(b,a)},info:function(){var a=["logger/info"];c.apply(a,arguments),d.apply(b,a)},error:function(){var a=["logger/error"];c.apply(a,arguments),d.apply(b,a)}})}),define("troopjs-core/component/gadget",["../event/emitter","when","../pubsub/hub"],function(a,b,c){"use strict";var d=Array.prototype,e=d.slice,f=d.push,g=c.publish,h=c.republish,i=c.subscribe,j=c.unsubscribe,k="length",l="features",m="type",n="value",o="subscriptions",p=a.prototype,q=p.on,r=p.off,s=p.reemit;return a.extend(function(){this[o]=[]},{displayName:"core/component/gadget","sig/initialize":function(){var a,b,d,e,f,g,h=this,j=h[o],p=h.constructor.specials.hub;for(d=0,e=p?p[k]:0;e>d;d++)b=p[d],a=j[d]={},a[m]=f=b[m],a[l]=b[l],a[n]=g=b[n],i.call(c,f,h,g)},"sig/start":function(){var a,d,e,f=this,g=arguments,i=f[o],j=[],p=0;for(d=0,e=i[k];e>d;d++)a=i[d],"memory"===a[l]&&(j[p++]=h.call(c,a[m],!1,f,a[n]));return b.all(j).yield(g)},"sig/finalize":function(){var a,b,d,e=this,f=e[o];for(b=0,d=f[k];d>b;b++)a=f[b],j.call(c,a[m],e,a[n])},reemit:function(a,b){var c=this,d=[a,b,c];return f.apply(d,e.call(arguments,2)),s.apply(c,d)},on:function(a){var b=this,c=[a,b];return f.apply(c,e.call(arguments,1)),q.apply(b,c)},off:function(a){var b=this,c=[a,b];return f.apply(c,e.call(arguments,1)),r.apply(b,c)},publish:function(){return g.apply(c,arguments)},republish:function(a,b){var d=this,g=[a,b,d];return f.apply(g,e.call(arguments,2)),h.apply(c,g)},subscribe:function(a){var b=this,d=[a,b];return f.apply(d,e.call(arguments,1)),i.apply(c,d),b},unsubscribe:function(a){var b=this,d=[a,b];return f.apply(d,e.call(arguments,1)),j.apply(c,d),b}})}),define("troopjs-core/component/service",["./gadget"],function(a){"use strict";return a.extend({displayName:"core/component/service","sig/initialize":function(){var a=this;return a.publish("registry/add",a)},"sig/finalize":function(){var a=this;return a.publish("registry/remove",a)}})}),define("troopjs-core/logger/service",["../component/service","troopjs-utils/merge","when"],function(a,b,c){"use strict";function d(a,b){var d=this,e=d.signal,f=[a],g=d[m],h=0;i.apply(f,b);var j=function(){var a;return(a=g[h++])?c(e.apply(a,f),j):c.resolve(b)};return j()}function e(a,c){var d={cat:a,time:(new Date).getTime()};return j.call(c)===k?b.call(d,c):d.msg=c,d}function f(a){var b,c,d=this,e=d[m];for(b=0,c=e[l];c>b;b++)e[b].append(a)}var g=Array.prototype,h=g.slice,i=g.push,j=Object.prototype.toString,k="[object Object]",l="length",m="appenders";return a.extend(function(){this[m]=h.call(arguments)},{displayName:"core/logger/service","sig/initialize":function(){return d.call(this,"initialize",arguments)},"sig/start":function(){return d.call(this,"start",arguments)},"sig/stop":function(){return d.call(this,"stop",arguments)},"sig/finalize":function(){return d.call(this,"finalize",arguments)},"hub/logger/log":function(a){f.call(this,e("log",a))},"hub/logger/warn":function(a){f.call(this,e("warn",a))},"hub/logger/debug":function(a){f.call(this,e("debug",a))},"hub/logger/info":function(a){f.call(this,e("info",a))},"hub/logger/error":function(a){f.call(this,e("error",a))}})}),define("troopjs-browser/ajax/service",["troopjs-core/component/service","jquery","troopjs-utils/merge","when"],function(a,b,c,d){"use strict";var e=Array.prototype.slice;return a.extend({displayName:"browser/ajax/service","hub/ajax":function(a){var f=b.ajax(c.call({headers:{"x-request-id":(new Date).getTime()}},a));return d(f,function(){return e.call(arguments)})}})}),define("troopjs-browser/loom/config",["module","troopjs-utils/merge"],function(a,b){"use strict";return b.call({$warp:"$warp",$weft:"$weft",weave:"data-weave",unweave:"data-unweave",woven:"data-woven"},a.config())}),define("troopjs-utils/getargs",[],function(){"use strict";var a=Array.prototype.push,b=String.prototype.substring,c=/^(?:false|true)$/i,d=/^true$/i,e=/^\d+$/;return function(){var f,g,h,i,j,k,l=this,m=[],n=!1;for(g=h=i=0,f=l.length;f>i;i++)switch(j=l.charAt(i)){case'"':case"'":n===j?(n=!1,a.call(m,b.call(l,g,h))):n=j,g=h=i+1;break;case",":if(n){h=i+1;break}g!==h&&(k=b.call(l,g,h),c.test(k)?k=d.test(k):e.test(k)&&(k=+k),a.call(m,k)),g=h=i+1;break;case" ":case"	":if(n){h=i+1;break}g===h&&(g=h=i+1);break;default:h=i+1}return g!==h&&(k=b.call(l,g,h),c.test(k)?k=d.test(k):e.test(k)&&(k=+k),a.call(m,k)),m}}),define("troopjs-browser/loom/weave",["./config","require","when","jquery","troopjs-utils/getargs","poly/array"],function(a,b,c,d,e){"use strict";var f,g=null,h=Array.prototype.push,i="weave",j="woven",k=a.$warp,l=a.$weft,m=a[i],n=a[j],o=/[\s,]+/;return function(){var a=arguments;return c.map(this,function(p){var q,r,s=d(p),t=s.data(),u=t[k]||(t[k]=[]),v=[],w=s.attr(m)||"",x=/[\s,]*(([\w_\-\/\.]+)(?:\(([^\)]+)\))?)/g,y=function(a){var b=a[l][j];s.attr(n,function(a,c){var d=[b];return c!==f&&h.apply(d,c.split(o)),d.join(" ")})};for(s.removeAttr(m);(r=x.exec(w))!==g;)q=[s,r[2]],q[i]=r[1],r[3]!==f&&h.apply(q,e.call(r[3]).map(function(a){return a in t?t[a]:a})),h.call(v,q);return c.map(v,function(d){var e=c.defer(),f=e.resolver,g=e.promise;return g[i]=d[i],h.call(u,g),c(g,y),b([d[1]],function(b){var c;try{c=b.apply(b,d),c[l]=g,g[j]=c.toString(),f.resolve(c.start.apply(c,a).yield(c))}catch(e){f.reject(e)}},f.reject),g})})}}),define("troopjs-browser/loom/unweave",["./config","when","jquery","poly/array"],function(a,b,c){"use strict";var d,e=null,f=Array.prototype.push,g="weave",h="unweave",i="woven",j="length",k=a.$warp,l=a.$weft,m=a[g],n=a[i],o=a[h],p=/[\s,]+/;return function(){var a=arguments;return b.map(this,function(h){var q,r,s,t,u,v=c(h),w=v.data(),x=w[k]||(w[k]=[]),y=[],z=v.attr(o)||"",A=[],B=/[\s,]*([\w_\-\/\.]+)(?:@(\d+))?/g,C=function(a){var b=a[l],c=b[i],e=b[g];v.attr(n,function(a,b){var e=[];return b!==d&&f.apply(e,b.split(p).filter(function(a){return a!==c})),0===e[j]?null:e.join(" ")}).attr(m,function(a,b){var c=[e];return b!==d&&f.apply(c,b.split(p)),c.join(" ")})};if(v.removeAttr(o),z===d)f.apply(y,x),x[j]=0;else{for(;(q=B.exec(z))!==e;)f.call(A,"^"+q[1]+"@"+(q[2]||"\\d+")+"$");for(A=new RegExp(A.join("|")),t=u=0,s=x[j];s>t;t++)r=x[t],A.test(r[i])?f.call(y,r):x[u++]=r;x[j]=u}return b.map(y,function(c){var d=c.stop.apply(c,a).yield(c);return b(d,C),d})})}}),define("troopjs-jquery/destroy",["jquery"],function(a){"use strict";var b="destroy";a.event.special[b]={noBubble:!0,trigger:function(){return!1},remove:function(b){var c=this;b&&b.handler.call(c,a.Event({type:b.type,data:b.data,namespace:b.namespace,target:c}))}}}),define("troopjs-browser/component/widget",["troopjs-core/component/gadget","jquery","../loom/config","../loom/weave","../loom/unweave","troopjs-jquery/destroy"],function(a,b,c,d,e){"use strict";function f(a,b){return function(){return b.apply(a,arguments)}}function g(a){function b(b){var c=this,e=i.call(arguments,1);return d.call(a.call(c[k],typeof b===j?b.apply(c,e):b).find(s))}return b}var h,i=Array.prototype.slice,j="function",k="$element",l="$handlers",m="features",n="type",o="value",p="proxy",q="guid",r="length",s="["+c.weave+"]",t="["+c.unweave+"]";return a.extend(function(a,b){var c=this;if(a===h)throw new Error("No $element provided");c[k]=a,c[l]=[],b!==h&&(c.displayName=b)},{displayName:"browser/component/widget","sig/initialize":function(){var a,b,c,d,e,g,h,i,j=this,s=j[k],t=j[l],u=j.constructor.specials.dom;for(h=0,i=u?u[r]:0;i>h;h++)b=u[h],a=t[h]={},a[n]=c=b[n],a[m]=d=b[m],a[o]=e=b[o],a[p]=g=f(j,e),s.on(c,d,j,g),e[q]=g[q]},"sig/finalize":function(){var a,b,c,d=this,e=d[k],f=d[l];for(b=0,c=f[r];c>b;b++)a=f[b],e.off(a[n],a[m],a[p])},weave:function(){return d.apply(this[k].find(s),arguments)},unweave:function(){return e.apply(this[k].find(t).addBack(),arguments)},"dom/destroy":function(){this.unweave()},before:g(b.fn.before),after:g(b.fn.after),html:g(b.fn.html),text:g(b.fn.text),append:g(b.fn.append),prepend:g(b.fn.prepend)})}),define("troopjs-core/registry/service",["../component/service","poly/object","poly/array"],function(a){"use strict";var b="services";return a.extend(function(){var a=this;a[b]={},a.add(a)},{displayName:"core/registry/service",add:function(a){this[b][a.toString()]=a},remove:function(a){delete this[b][a.toString()]},get:function(a){var c=new RegExp(a),d=this[b];return Object.keys(d).filter(function(a){return c.test(a)}).map(function(a){return d[a]})},"hub/registry/add":function(a){return this.add(a)},"hub/registry/remove":function(a){return this.remove(a)},"hub/registry/get":function(a){return this.get(a)}})}),define("troopjs-browser/application/widget",["module","../component/widget","when","troopjs-core/registry/service","poly/array"],function(a,b,c,d){"use strict";function e(a,b){var d=this,e=d.signal,f=[a],g=d[i].get(),j=0;h.apply(f,b);var k=function(){var a;return(a=g[j++])?c(e.apply(a,f),k):c.resolve(b)};return k()}var f=Array.prototype,g=f.slice,h=f.push,i="registry";return b.extend(function(){var a=this[i]=d();g.call(arguments,2).forEach(function(b){a.add(b)})},{displayName:"browser/application/widget","sig/initialize":function(){return e.call(this,"initialize",arguments)},"sig/start":function(){var a=this,b=a.weave,c=arguments;return e.call(a,"start",c).then(function(){return b.apply(a,c)})},"sig/stop":function(){var a=this,b=a.unweave,c=arguments;return b.apply(a,c).then(function(){return e.call(a,"stop",c)})},"sig/finalize":function(){return e.call(this,"finalize",arguments)}})}),define("troopjs-browser/route/uri",["troopjs-core/component/factory"],function(a){"use strict";function b(a){var c,e,f={},g=d,h=/(?:&|^)([^&=]*)=?([^&]*)/g;if(f.toString=b.toString,i.call(a)===j)for(g in a)f[g]=a[g];else for(;(c=h.exec(a))!==d;)g=c[1],g in f?(e=f[g],i.call(e)===k?e[e.length]=c[2]:f[g]=[e,c[2]]):f[g]=c[2];return f}function c(a){var b=[];return b.toString=c.toString,g.apply(b,i.call(a)===k?a:h.call(a,"/")),b}var d=null,e=Array.prototype,f=Object.prototype,g=e.push,h=String.prototype.split,i=f.toString,j=i.call(f),k=i.call(e),l=i.call(Function.prototype),m=/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?(?:([^?#]*)(?:\?([^#]*))?(?:#(.*))?)/,n="protocol",o="authority",p="path",q="query",r="anchor",s=["source",n,o,"userInfo","user","password","host","port",p,q,r];b.toString=function(){var a,b,c,d,e=this,f=[],g=0;for(a in e)i.call(e[a])!==l&&(f[g++]=a);for(f.sort();g--;)if(a=f[g],b=e[a],i.call(b)===k){for(c=b.slice(0),c.sort(),d=c.length;d--;)b=c[d],c[d]=""===b?a:a+"="+b;f[g]=c.join("&")}else f[g]=""===b?a:a+"="+b;return f.join("&")},c.toString=function(){return this.join("/")};var t=a(function(a){var e,f,g,h=this;if((f=m.exec(a))!==d)for(g=f.length;g--;)e=f[g],e&&(h[s[g]]=e);q in h&&(h[q]=b(h[q])),p in h&&(h[p]=c(h[p]))},{displayName:"browser/route/uri",toString:function(){var a,b,c=this,d=[n,"://",o,p,"?",q,"#",r];n in c||(d[0]=d[1]=""),o in c||(d[2]=""),p in c||(d[3]=""),q in c||(d[4]=d[5]=""),r in c||(d[6]=d[7]=""),a=d.length;for(;a--;)b=d[a],b in c&&(d[a]=c[b]);return d.join("")}});return t.Path=c,t.Query=b,t}),define("troopjs-jquery/hashchange",["jquery"],function(a){"use strict";function b(a){var b=g.exec(a.location.href);return b&&b[1]?decodeURIComponent(b[1]):""}function c(a){var b,c=this;c.element=b=a.createElement("iframe"),b.src="about:blank",b.style.display="none"}var d="interval",e="hashchange",f="on"+e,g=/#(.*)$/,h=/\?/,i=0;c.prototype={getElement:function(){return this.element},getHash:function(){return this.element.contentWindow.frameHash},update:function(a){var b=this,c=b.element.contentWindow.document;b.getHash()!==a&&(c.open(),c.write("<html><head><title>' + document.title + '</title><script type='text/javascript'>var frameHash='"+a+"';</script></head><body>&nbsp;</body></html>"),c.close())}},a.event.special[e]={setup:function(){var g=this;if(f in g)return!1;if(!a.isWindow(g))throw new Error("Unable to bind 'hashchange' to a non-window object");var j=a(g),k=b(g),l=g.location;j.data(d,g.setInterval(i?function(){var a=g.document,d="file:"===l.protocol,f=new c(a);return a.body.appendChild(f.getElement()),f.update(k),function(){var a,c=k,i=b(g),m=f.getHash();m!==k&&m!==i?(a=decodeURIComponent(m),k!==a&&(k=a,f.update(k),j.trigger(e,[a,c])),l.hash="#"+encodeURI(d?m.replace(h,"%3F"):m)):i!==k&&(a=decodeURIComponent(i),k!==a&&(k=a,j.trigger(e,[a,c])))}}():function(){var a,c=k,d=b(g);d!==k&&(a=decodeURIComponent(d),k!==a&&(k=a,j.trigger(e,[a,c])))},25))},teardown:function(){var b=this;return f in b?!1:(b.clearInterval(a.data(b,d)),void 0)}}}),define("troopjs-browser/route/widget",["../component/widget","./uri","troopjs-jquery/hashchange"],function(a,b){"use strict";function c(a){var c=a.data,d=b(a.target.location.hash.replace(g,"")),e=d.toString();e!==c[f]&&(c[f]=e,c.publish(c.displayName,d,a))}var d="$element",e="hashchange",f="route",g=/^#/;return a.extend({displayName:"browser/route/widget","sig/initialize":function(){var a=this;a[d].on(e,a,c)},"sig/start":function(){this[d].trigger(e)},"sig/finalize":function(){this[d].off(e,c)}})}),define("troopjs-bundle/micro",["troopjs-core/logger/console","troopjs-core/logger/pubsub","troopjs-core/logger/service","troopjs-browser/ajax/service","troopjs-browser/application/widget","troopjs-browser/route/widget"]);