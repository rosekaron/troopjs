<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">/*
 * TroopJS browser/application/widget
 * @license MIT http://troopjs.mit-license.org/ Â© Mikael Karon mailto:mikael@karon.se
 */
define([ &quot;module&quot;, &quot;../component/widget&quot;, &quot;when&quot;, &quot;troopjs-core/registry/service&quot;, &quot;poly/array&quot; ], function ApplicationWidgetModule(module, Widget, when, RegistryService) {
	&quot;use strict&quot;;

	var UNDEFINED;
	var ARRAY_PROTO = Array.prototype;
	var ARRAY_SLICE = ARRAY_PROTO.slice;
	var ARRAY_PUSH = ARRAY_PROTO.push;
	var REGISTRY = &quot;registry&quot;;

	/*
	 * Forwards _signal to components
	 * @private
	 * @param {String} _signal Signal to forward
	 * @param {Array} _args Signal arguments
	 * @return {Promise} promise of next handler callback execution
	 */
	function forward(_signal, _args) {
		/*jshint validthis:true*/
		var me = this;
		var args = [ _signal ];
		var components = me[REGISTRY].get();
		var componentsCount = 0;
		var results = [];
		var resultsCount = 0;

		ARRAY_PUSH.apply(args, _args);

		var next = function (result, skip) {
			var component;

			if (skip !== true) {
				results[resultsCount++] = result;
			}

			return (component = components[componentsCount++]) !== UNDEFINED
				? when(component.signal.apply(component, args), next)
				: when.resolve(results);
		};

		return next(UNDEFINED, true);
	}

<span id='browser-application-widget'>	/**
</span>	 * The application widget serves as top-most page component
	 * that bootstrap all other components registered.
	 * @class browser.application.widget
	 */
	return Widget.extend(function ApplicationWidget() {
		// Create registry
		var registry = this[REGISTRY] = RegistryService();

		// TODO only register _services_
		// Slice and iterate arguments
		ARRAY_SLICE.call(arguments, 2).forEach(function (component) {
			// Register component
			registry.add(component);
		});
	}, {
		&quot;displayName&quot; : &quot;browser/application/widget&quot;,

		&quot;sig/initialize&quot; : function onInitialize() {
			return forward.call(this, &quot;initialize&quot;, arguments);
		},

		&quot;sig/start&quot; : function onStart() {
			var me = this;
			var args = arguments;

			return forward.call(me, &quot;start&quot;, args).then(function started() {
				return me.weave.apply(me, args);
			});
		},

		&quot;sig/stop&quot; : function onStop() {
			var me = this;
			var args = arguments;

			return me.unweave.apply(me, args).then(function stopped() {
				return forward.call(me, &quot;stop&quot;, args);
			});
		},

		&quot;sig/finalize&quot; : function onFinalize() {
			return forward.call(this, &quot;finalize&quot;, arguments);
		}
	});
});</pre>
</body>
</html>
